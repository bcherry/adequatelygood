(function(){var d=jQuery,c,i,g,m="/",a="_tmpl_postDialog",o,e,p,n,l,b,r,k,h,q,j,f;e=function(t,v,s){var u={"400":"Uh oh!  I couldn't save your post.  Seriously, I have no idea what went wrong."};if(!(t.status in u)){u[t.status]="Ooops!  There was a mysterious error of some kind.  Sorry about that!  ("+t.status+" - "+t.statusText+")"}g.errorText.text(u[t.status]);g.error.show()};p=function(s){consul.log("submission complete, response: "+s);window.location.href=s};n=function(){var s=new Date(),v=s.getMonth()+1,t=s.getFullYear();i=d("<div/>");g=i.tmpl(a,{});i.dialog(c);function u(){i.dialog("open")}switch(d(this).attr("id")){case"newarticle":m="/";l("","","");break;case"newblog":m="/"+t+"/"+v;l("","","");break;case"editbtn":m="?_method=PUT";u();return}u();return false};l=function(s,u,t){if(s===undefined){s=""}d(g.postBody).val(s);if(u!==undefined){d(g.postTitle).val(u)}if(t!==undefined){if(t.constructor===Array){t=t.join(", ")}d(g.postTags).val(t)}};o={cache:false,dataType:"text",error:e,success:p,type:"POST"};b=function(){var s=d(g.postBody).val(),v=d(g.postTitle).val(),u=d(g.postTags).val(),t=o;g.error.hide();consul.log("beginning submission");t.url=m;t.data={body:s,title:v,tags:u};d.ajax(t)};r=function(){i.dialog("destroy");i=null;g=null};k=function(){i.dialog("close");r()};h=function(s,t){r();consul.log("dialog closed")};q=function(s,t){consul.log("dialog opened")};c={autoOpen:false,modal:true,title:"an adequately good post editor",width:800,close:h,open:q,buttons:{post:b,cancel:k}};j=function(){d.ajax({type:"DELETE",url:"#",success:function(s){window.location.href=s},dataType:"text"})};f=function(){d("<div/>").text("Are you sure you want to delete this entry?").dialog({modal:true,title:"confirm deletion",buttons:{"delete it":j,cancel:function(){d(this).dialog("destroy")}}})};d(function(){d("#newblog, #newarticle, #editbtn").live("click",n);d("#deletebtn").live("click",f);d(":contains(TODO)").not(":has(:contains(TODO))").each(function(){var t=d(this),s=t.html();s=s.replace(/(\(TODO:.*?\))/g,'<span class="todo">$1</span>');t.html(s)})})}());